<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial of rgeoda v0.0.6 • rgeoda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial of rgeoda v0.0.6">
<meta property="og:description" content="rgeoda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rgeoda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rgeoda_esda_sf_0_0_6.html">ESDA_using_rgeoda_sf</a>
    </li>
    <li>
      <a href="../articles/rgeoda_tutorial_0_0_6.html">Tutorial of rgeoda v0.0.6</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lixun910/rgeoda/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="rgeoda_tutorial_0_0_6_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial of rgeoda v0.0.6</h1>
                        <h4 class="author">lixun910</h4>
            
            <h4 class="date">1/6/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lixun910/rgeoda/blob/master/vignettes/rgeoda_tutorial_0_0_6.Rmd"><code>vignettes/rgeoda_tutorial_0_0_6.Rmd</code></a></small>
      <div class="hidden name"><code>rgeoda_tutorial_0_0_6.Rmd</code></div>

    </div>

    
    
<p><code>rgeoda</code> is an R library for spatial data analysis. It is an R wrapper of the libgeoda C++ library, which is built based on the <code>GeoDa</code> software. The version used in this tutorial is version 0.0.6.</p>
<div id="install-rgeoda" class="section level2">
<h2 class="hasAnchor">
<a href="#install-rgeoda" class="anchor"></a>1. Install <code>rgeoda</code>
</h2>
<p>rgeoda will be submitted to CRAN soon. Once it is accepted, one should be able to install rgeoda in R console</p>
<pre><code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("rgeoda")</a></code></pre>
<div id="load-rgeoda-library-in-r" class="section level3">
<h3 class="hasAnchor">
<a href="#load-rgeoda-library-in-r" class="anchor"></a>Load <code>rgeoda</code> library in R</h3>
<p>If everything installed without error, you should be able to load <code>rgeoda</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rgeoda</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="load-spatial-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-spatial-data" class="anchor"></a>2. Load Spatial Data</h2>
<p>The data formats that <code>rgeoda</code> can read directly includes ESRI Shapefile and Geojson (coming in next version).</p>
<p>For example, to load the ESRI Shapefile <code>Guerry.shp</code> comes with the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">guerry_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Guerry.shp"</span>, package <span class="op">=</span> <span class="st">"rgeoda"</span><span class="op">)</span>
<span class="va">guerry</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geoda_open.html">geoda_open</a></span><span class="op">(</span><span class="va">guerry_path</span><span class="op">)</span></code></pre></div>
<p>The <code>geoda_open</code> function returns a <code>geoda</code> object, which can be used to access the meta-data, fields, and columns of the input dataset.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">guerry_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">guerry</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">guerry_df</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "data.frame"</code></pre>
<p>Now guerry_df is a data frame.</p>
<div id="attributes-of-geoda_df-dataframe" class="section level4">
<h4 class="hasAnchor">
<a href="#attributes-of-geoda_df-dataframe" class="anchor"></a>2.1 Attributes of <code>geoda_df</code> dataframe</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">guerry_df</span><span class="op">)</span></code></pre></div>
<pre><code>##      CODE_DE COUNT AVE_ID_ dept Region      Dprtmnt Crm_prs Crm_prp Litercy
## NA        01     1      49    1      E          Ain   28870   15890      37
## NA.1      02     1     812    2      N        Aisne   26226    5521      51
## NA.2      03     1    1418    3      C       Allier   26747    7925      13
## NA.3      04     1    1603    4      E Basses-Alpes   12935    7289      46
## NA.4      05     1    1802    5      E Hautes-Alpes   17488    8174      69
## NA.5      07     1    2249    7      S      Ardeche    9474   10263      27
##      Donatns Infants Suicids MainCty Wealth Commerc Clergy Crm_prn Infntcd
## NA      5098   33120   35039       2     73      58     11      71      60
## NA.1    8901   14572   12831       2     22      10     82       4      82
## NA.2   10973   17044  114121       2     61      66     68      46      42
## NA.3    2733   23018   14238       1     76      49      5      70      12
## NA.4    6962   23076   16171       1     83      65     10      22      23
## NA.5    3188   42117   52547       1     84       1     28      76      47
##      Dntn_cl Lottery Desertn Instrct Prsttts Distanc Area Pop1831 TopCrm TopLit
## NA        69      41      55      46      13 218.372 5762  346.03      1      0
## NA.1      36      38      82      24     327  65.945 7369  513.00      1      1
## NA.2      76      66      16      85      34 161.927 7340  298.26      1      0
## NA.3      37      80      32      29       2 351.399 6925  155.90      0      1
## NA.4      64      79      35       7       1 320.280 5549  129.10      0      1
## NA.5      67      70      19      62       1 279.413 5529  340.73      0      0
##      TopWealth
## NA           1
## NA.1         0
## NA.2         1
## NA.3         1
## NA.4         1
## NA.5         1</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">guerry_df</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 29</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">guerry_df</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 85</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">guerry_df</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "CODE_DE"   "COUNT"     "AVE_ID_"   "dept"      "Region"    "Dprtmnt"  
##  [7] "Crm_prs"   "Crm_prp"   "Litercy"   "Donatns"   "Infants"   "Suicids"  
## [13] "MainCty"   "Wealth"    "Commerc"   "Clergy"    "Crm_prn"   "Infntcd"  
## [19] "Dntn_cl"   "Lottery"   "Desertn"   "Instrct"   "Prsttts"   "Distanc"  
## [25] "Area"      "Pop1831"   "TopCrm"    "TopLit"    "TopWealth"</code></pre>
</div>
<div id="access-table-data" class="section level3">
<h3 class="hasAnchor">
<a href="#access-table-data" class="anchor"></a>2.2 Access Table Data</h3>
<p>Get data from first colum:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">guerry_df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></code></pre></div>
<pre><code>##  [1] "01" "02" "03" "04" "05" "07" "08" "09" "10" "11" "12" "13" "14" "15" "16"
## [16] "17" "18" "19" "21" "22" "23" "24" "25" "26" "27" "28" "29" "30" "31" "32"
## [31] "33" "34" "35" "36" "37" "38" "39" "40" "41" "42" "43" "44" "45" "46" "47"
## [46] "48" "49" "50" "51" "52" "53" "54" "55" "56" "57" "58" "59" "60" "61" "62"
## [61] "63" "64" "65" "66" "67" "68" "69" "70" "71" "72" "75" "76" "77" "78" "79"
## [76] "80" "81" "82" "83" "84" "85" "86" "87" "88" "89"</code></pre>
<p>Get data from first row:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">guerry_df</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></code></pre></div>
<pre><code>##    CODE_DE COUNT AVE_ID_ dept Region Dprtmnt Crm_prs Crm_prp Litercy Donatns
## NA      01     1      49    1      E     Ain   28870   15890      37    5098
##    Infants Suicids MainCty Wealth Commerc Clergy Crm_prn Infntcd Dntn_cl
## NA   33120   35039       2     73      58     11      71      60      69
##    Lottery Desertn Instrct Prsttts Distanc Area Pop1831 TopCrm TopLit TopWealth
## NA      41      55      46      13 218.372 5762  346.03      1      0         1</code></pre>
<p>Get data from 3-rd and 5-th columns:</p>
<pre><code>guerry_df[,c(3,5)]</code></pre>
<p>Get data from column ‘Crm_prs’</p>
<pre><code>guerry_df['Crm_prs']</code></pre>
<p>The above code returns a data.frame, you can get the list values by:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crm_prs</span> <span class="op">&lt;-</span> <span class="va">guerry_df</span><span class="op">[</span><span class="st">'Crm_prs'</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">crm_prs</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "numeric"</code></pre>
<p>Get data from multiple columns using the column names:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crm_prs_prp</span> <span class="op">&lt;-</span> <span class="va">guerry_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Crm_prs'</span>, <span class="st">'Crm_prp'</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">crm_prs_prp</span><span class="op">)</span></code></pre></div>
<pre><code>##      Crm_prs Crm_prp
## NA     28870   15890
## NA.1   26226    5521
## NA.2   26747    7925
## NA.3   12935    7289
## NA.4   17488    8174
## NA.5    9474   10263</code></pre>
</div>
</div>
<div id="spatial-weights" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-weights" class="anchor"></a>3. Spatial Weights</h2>
<p>Spatial weights are central components in spatial data analysis. The spatial weights represent the possible spatial interactions between observations in space. Like <code>GeoDa</code> desktop software, <code>rgeoda</code> provides a rich variety of methods to create several different types of spatial weights:</p>
<ul>
<li>Contiguity Based Weights: <code><a href="../reference/queen_weights.html">queen_weights()</a></code>, <code><a href="../reference/rook_weights.html">rook_weights()</a></code>
</li>
<li>Distance Based Weights: <code><a href="../reference/distance_weights.html">distance_weights()</a></code>
</li>
<li>K-Nearest Neighbor Weights: <code><a href="../reference/knn_weights.html">knn_weights()</a></code>
</li>
<li>Kernel Weights: <code><a href="../reference/distance_weights.html">distance_weights()</a></code> and <code><a href="../reference/knn_weights.html">knn_weights()</a></code> with kernel parameters</li>
</ul>
<div id="queen-contiguity-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#queen-contiguity-weights" class="anchor"></a>3.1 Queen Contiguity Weights</h3>
<p>To create a Queen contiguity weights, we can call rgeoda’s function</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/queen_weights.html">queen_weights</a></span><span class="op">(</span><span class="va">gda</span>, order<span class="op">=</span><span class="fl">1</span>, include_lower_order <span class="op">=</span> <span class="va">False</span>, precision_threshold <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>by passing the <code>GeoDa</code> object <code>guerry</code> we just created:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">queen_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/queen_weights.html">queen_weights</a></span><span class="op">(</span><span class="va">guerry</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">queen_w</span><span class="op">)</span></code></pre></div>
<pre><code>##                      name     value
## 1 number of observations: 85.000000
## 2          is symmetric:   1.000000
## 3               sparsity:  0.000000
## 4                density:  5.813149
## 5        # min neighbors:  2.000000
## 6        # max neighbors:  8.000000
## 7       # mean neighbors:  4.941176
## 8     # median neighbors:  5.000000
## 9         has isolations:  0.000000</code></pre>
<p>The function <code><a href="../reference/queen_weights.html">queen_weights()</a></code> returns an instance of <code>Weight</code> object. One can access the meta data of the spatial weights by accessing the attributes of <code>GeoDaWeight</code> object:</p>
<div id="attributes-of-weight-object" class="section level4">
<h4 class="hasAnchor">
<a href="#attributes-of-weight-object" class="anchor"></a>Attributes of <code>Weight</code> object</h4>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/is_symmetric.html">is_symmetric</a></span><span class="op">(</span><span class="va">queen_w</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/has_isolates.html">has_isolates</a></span><span class="op">(</span><span class="va">queen_w</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/weights_sparsity.html">weights_sparsity</a></span><span class="op">(</span><span class="va">queen_w</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/weights_density.html">weights_density</a></span><span class="op">(</span><span class="va">queen_w</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 5.813149</code></pre>
<p>We can also access the details of the weights: e.g. list the neighbors of a specified observation, which is very helpful in exploratory spatial data analysis (which is focused in next tutorial):</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nbrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_neighbors.html">get_neighbors</a></span><span class="op">(</span><span class="va">queen_w</span>, idx <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nNeighbors of the 1-st observation are:"</span>, <span class="va">nbrs</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Neighbors of the 1-st observation are: 36 37 67 69</code></pre>
<p>We can also compute the spatial lag of a specified observation by passing the values of the selected variable:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lag0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_lag.html">spatial_lag</a></span><span class="op">(</span><span class="va">queen_w</span>, idx <span class="op">=</span> <span class="fl">1</span>, values <span class="op">=</span> <span class="va">crm_prs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nSpatial lag of the 1-st observation of variable crm_prs is:"</span>, <span class="va">lag0</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Spatial lag of the 1-st observation of variable crm_prs is: 23047.5</code></pre>
</div>
</div>
<div id="rook-contiguity-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#rook-contiguity-weights" class="anchor"></a>3.2 Rook Contiguity Weights</h3>
<p>To create a Rook contiguity weights, we can call <code>rgeoda</code>’s function <code>rook_weights</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rook_weights.html">rook_weights</a></span><span class="op">(</span><span class="va">gda</span>, order<span class="op">=</span><span class="fl">1</span>,include_lower_order<span class="op">=</span><span class="va">False</span>, precision_threshold <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>by passing the <code>GeoDa</code> object <code>guerry</code> we just created:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rook_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rook_weights.html">rook_weights</a></span><span class="op">(</span><span class="va">guerry</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">rook_w</span><span class="op">)</span></code></pre></div>
<pre><code>##                      name     value
## 1 number of observations: 85.000000
## 2          is symmetric:   1.000000
## 3               sparsity:  0.000000
## 4                density:  5.813149
## 5        # min neighbors:  2.000000
## 6        # max neighbors:  8.000000
## 7       # mean neighbors:  4.941176
## 8     # median neighbors:  5.000000
## 9         has isolations:  0.000000</code></pre>
<p>The weights we created are in memory, which makes it straight forward for spatial data analysis and also are good for programming your application. To save the weights to a file, we need to call the function <code>save_weights</code></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/save_weights.html">save_weights</a></span><span class="op">(</span><span class="va">gda_w</span>, <span class="va">out_path</span>, <span class="va">layer_name</span>, <span class="va">id_name</span>, <span class="va">id_values</span><span class="op">)</span></code></pre></div>
<p>The <code>layer_name</code> is the layer name of loaded dataset. For a ESRI shapefile, the layer name is the file name without the suffix (e.g. Guerry).</p>
<p>The <code>id_name</code> is a key (column name), which means the associated column contains unique values, that makes sure that the weights are connected to the correct observations in the data table.</p>
<p>The <code>id_vec</code> is the actual column data of <code>id_name</code>, it could be a tuple of integer or string values.</p>
<p>For example, in Guerry dataset, the column “CODE_DE” can be used as a key to save a weights file:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/save_weights.html">save_weights</a></span><span class="op">(</span><span class="va">rook_w</span>, out_path <span class="op">=</span> <span class="st">'/Users/xun/Downloads/Guerry_r.gal'</span>, 
             layer_name <span class="op">=</span> <span class="st">'Guerry'</span>, 
             id_name <span class="op">=</span> <span class="st">'CODE_DE'</span>, 
             id_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">guerry_df</span><span class="op">[</span><span class="st">'CODE_DE'</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Then, we should find the file “Guerry_r.gal” in the output directory.</p>
</div>
<div id="distance-based-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#distance-based-weights" class="anchor"></a>3.3 Distance Based Weights</h3>
<p>To create a Distance based weights, we can call <code>rgeoda</code>’s function <code>distance_weights</code></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/distance_weights.html">distance_weights</a></span><span class="op">(</span><span class="va">geoda_obj</span>, <span class="va">dist_thres</span>, power<span class="op">=</span><span class="fl">1.0</span>,  is_inverse<span class="op">=</span><span class="va">False</span>, is_arc<span class="op">=</span><span class="va">False</span>, is_mile<span class="op">=</span><span class="va">True</span><span class="op">)</span></code></pre></div>
<p>by passing the <code>GeoDa</code> object <code>guerry</code> we just created the value of distance threshold.</p>
<p>Like <code>GeoDa</code>, <code>rgeoda</code> also provides a function <code>min_distthreshold</code> to help you find a optimized distance threshold that guarantees that every observation has at least one neighbor:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">min_distthreshold</span>(GeoDa gda, bool <span class="dt">is_arc =</span> False, <span class="dt">is_mile =</span> True)</span></code></pre></div>
<p>For example, we first find the distance threshold using <code>min_distthreshold</code>, save the results into <code>dist_thres</code>, then pass this threshold <code>dist_thres</code> into the function <code>dist_w</code> to create a distance based weights for <code>guerry</code>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist_thres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/min_distthreshold.html">min_distthreshold</a></span><span class="op">(</span><span class="va">guerry</span><span class="op">)</span>
<span class="va">dist_thres</span></code></pre></div>
<pre><code>## [1] 96726.14</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distance_weights.html">distance_weights</a></span><span class="op">(</span><span class="va">guerry</span>, <span class="va">dist_thres</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dist_w</span><span class="op">)</span></code></pre></div>
<pre><code>##                      name     value
## 1 number of observations: 85.000000
## 2          is symmetric:   0.000000
## 3               sparsity:  0.000000
## 4                density:  4.346021
## 5        # min neighbors:  1.000000
## 6        # max neighbors:  7.000000
## 7       # mean neighbors:  3.694118
## 8     # median neighbors:  4.000000
## 9         has isolations:  0.000000</code></pre>
</div>
<div id="k-nearest-neighbor-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#k-nearest-neighbor-weights" class="anchor"></a>3.4 K-Nearest Neighbor Weights</h3>
<p>A special case of distance based weights is K-Nearest neighbor weights, in which every obersvation will have exactly k neighbors. To create a KNN weights, we can call <code>rgeoda</code>’s function <code>knn_weights</code>:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/knn_weights.html">knn_weights</a></span><span class="op">(</span><span class="va">gda</span>, <span class="va">k</span>, power <span class="op">=</span> <span class="fl">1.0</span>,is_inverse <span class="op">=</span> <span class="va">False</span>, is_arc <span class="op">=</span> <span class="va">False</span>, is_mile <span class="op">=</span> <span class="va">True</span><span class="op">)</span></code></pre></div>
<p>For example, to create a 6-nearest neighbor weights using Guerry dataset:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">knn6_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/knn_weights.html">knn_weights</a></span><span class="op">(</span><span class="va">guerry</span>, <span class="fl">6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">knn6_w</span><span class="op">)</span></code></pre></div>
<pre><code>##                      name     value
## 1 number of observations: 85.000000
## 2          is symmetric:   0.000000
## 3               sparsity:  0.000000
## 4                density:  7.058824
## 5        # min neighbors:  6.000000
## 6        # max neighbors:  6.000000
## 7       # mean neighbors:  6.000000
## 8     # median neighbors:  6.000000
## 9         has isolations:  0.000000</code></pre>
</div>
<div id="kernel-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#kernel-weights" class="anchor"></a>3.5 Kernel Weights</h3>
<p>Kernel weights apply kernel function to determine the distance decay in the derived continuous weights kernel. The kernel weights are defined as a function K(z) of the ratio between the distance dij from i to j, and the bandwidth hi, with z=dij/hi.</p>
<p>The kernel functions include</p>
<ul>
<li>triangular</li>
<li>uniform</li>
<li>quadratic</li>
<li>epanechnikov</li>
<li>quartic</li>
<li>gaussian</li>
</ul>
<p>Two functions are provided in <code>rgeoda</code> to create kernel weights.</p>
<div id="use-kernel_weights-for-kernel-weights-with-adaptive-bandwidth" class="section level4">
<h4 class="hasAnchor">
<a href="#use-kernel_weights-for-kernel-weights-with-adaptive-bandwidth" class="anchor"></a>Use <code>kernel_weights</code> for Kernel Weights with adaptive bandwidth</h4>
<p>To create a kernel weights with fixed bandwith:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bandwidth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/min_distthreshold.html">min_distthreshold</a></span><span class="op">(</span><span class="va">guerry</span><span class="op">)</span>
<span class="va">kernel_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kernel_weights.html">kernel_weights</a></span><span class="op">(</span><span class="va">guerry</span>, <span class="va">bandwidth</span>, kernel_method <span class="op">=</span> <span class="st">"uniform"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">kernel_w</span><span class="op">)</span></code></pre></div>
<pre><code>##                      name     value
## 1 number of observations: 85.000000
## 2          is symmetric:   0.000000
## 3               sparsity:  0.000000
## 4                density:  4.346021
## 5        # min neighbors:  1.000000
## 6        # max neighbors:  7.000000
## 7       # mean neighbors:  3.694118
## 8     # median neighbors:  4.000000
## 9         has isolations:  0.000000</code></pre>
<p>The arguments <code>is_inverse</code>, <code>power</code>, <code>is_arc</code> and <code>is_mile</code> are the same with the distance based weights. Additionally, <code>kernel_weights</code> has another argument that user can specify:</p>
<pre><code>use_kernel_diagonals    
(optional) FALSE (default) or TRUE, apply kernel on the diagonal of weights matrix</code></pre>
</div>
<div id="use-kernel_knn_weights-for-kernel-weights-with-adaptive-bandwidth" class="section level4">
<h4 class="hasAnchor">
<a href="#use-kernel_knn_weights-for-kernel-weights-with-adaptive-bandwidth" class="anchor"></a>Use <code>kernel_knn_weights</code> for Kernel Weights with adaptive bandwidth</h4>
<p>To create a kernel weights with adaptive bandwidth or using max Knn distance as bandwidth:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adptkernel_w</span> <span class="op">=</span> <span class="fu"><a href="../reference/kernel_knn_weights.html">kernel_knn_weights</a></span><span class="op">(</span><span class="va">guerry</span>, <span class="fl">6</span>, <span class="st">"uniform"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">adptkernel_w</span><span class="op">)</span></code></pre></div>
<pre><code>##                      name     value
## 1 number of observations: 85.000000
## 2          is symmetric:   0.000000
## 3               sparsity:  0.000000
## 4                density:  7.058824
## 5        # min neighbors:  6.000000
## 6        # max neighbors:  6.000000
## 7       # mean neighbors:  6.000000
## 8     # median neighbors:  6.000000
## 9         has isolations:  0.000000</code></pre>
<p>This kernel weights function two more arguments that user can specify:</p>
<pre><code>adaptive_bandwidth  
(optional) TRUE (default) or FALSE: TRUE use adaptive bandwidth calculated using distance of k-nearest neithbors, FALSE use max distance of all observation to their k-nearest neighbors

use_kernel_diagonals    
(optional) FALSE (default) or TRUE, apply kernel on the diagonal of weights matrix</code></pre>
</div>
</div>
</div>
<div id="spatial-data-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-data-analysis" class="anchor"></a>4 Spatial Data Analysis</h2>
<div id="local-spatial-autocorrelation" class="section level3">
<h3 class="hasAnchor">
<a href="#local-spatial-autocorrelation" class="anchor"></a>4.1 Local Spatial Autocorrelation</h3>
<p><code>rgeoda</code> 0.0.6 provids following methods for <em>univariate local</em> spatial autocorrelation statistics:</p>
<ul>
<li>Local Moran: local_moran()</li>
<li>Local Geary: local_geary(), local_multigeary()</li>
<li>Local Getis-Ord statistics: local_g() and local_gstar()</li>
<li>Local Join Count: local_joincount(), local_multijoincount()</li>
<li>Quantile LISA: local_quantilelisa()</li>
</ul>
<p>Methods for <em>bivariate</em> and <em>multivariate local</em> spatial autocorrelation statistics, as well as <em>global</em> spatial autocorrelation statistics, will be included in the next release of <code>rgeoda</code>.</p>
<p>In this tutorial, we will only introduce how to call these methods using <code>rgeoda</code>. Please read <a href="http://geodacenter.github.io/workbook/6a_local_auto/lab6a.html">here</a> for more information about the local spatial autocorrelation statistics.</p>
<div id="local-moran" class="section level4">
<h4 class="hasAnchor">
<a href="#local-moran" class="anchor"></a>4.1.1 Local Moran</h4>
<p>The Local Moran statistic is a method to identify local clusters and local spatial outliers. For example, we can call the function <code><a href="../reference/local_moran.html">local_moran()</a></code> with the created Queen weights and apply the Local Moran to analyze the spatial patterns for the variable “crm_prp”:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lisa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_moran.html">local_moran</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">crm_prs</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/local_moran.html">local_moran()</a></code> function will return a <code>lisa</code> object, which we can call its public functions to access the results of lisa computation.</p>
<p>For example, we can call the function <code><a href="../reference/lisa_values.html">lisa_values()</a></code> to get the values of the local Moran:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisa_values.html">lisa_values</a></span><span class="op">(</span>gda_lisa <span class="op">=</span> <span class="va">lisa</span><span class="op">)</span>
<span class="va">lms</span></code></pre></div>
<pre><code>##  [1]  0.516120231  0.818275138  0.794086560  0.733161543  0.228467334
##  [6]  0.829040272  0.615280448  1.627415446 -0.019525625  0.687081885
## [11]  1.707896579  0.821748275 -0.213568315  0.291316827 -0.184833414
## [16] -0.047198613  0.249972417  0.054411195  0.862095943  0.835368441
## [21]  0.538432168 -0.050446242 -0.681022658  0.678851849 -0.105369231
## [26]  0.038567922  1.116236578  1.168138859  0.162030880  0.069037225
## [31]  0.021522359  1.000255304  0.276308094  0.423159405 -0.101271972
## [36]  0.015647332  0.554846307 -0.027584417  0.111200075 -0.082994402
## [41]  0.281817532 -0.048962443 -0.015839144  0.830286100 -0.160743989
## [46]  1.597607483  0.396712769  0.862342357 -0.466396879  0.262343383
## [51]  1.424738721 -0.379247703  0.388066026  0.316231271  0.068795845
## [56]  0.405538158  0.977019076  0.202610060  0.714533504  0.601447598
## [61] -0.177594467  0.229608404  0.284505927  2.247991283  0.532787318
## [66]  1.039424040 -0.129846379  0.136565215  1.033851456  1.238521154
## [71]  0.296054062 -0.167632280 -0.041663121  0.036396148 -0.055081083
## [76]  1.166507105  0.773315084  0.523682291  0.851277285  0.884651013
## [81]  0.025497212 -0.326497225 -0.306819894  0.001277301 -0.125219240</code></pre>
<p>We can use <code><a href="../reference/lisa_pvalues.html">lisa_pvalues()</a></code> to get the pseudo-p values of significance of local Moran computation:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span>
<span class="va">pvals</span></code></pre></div>
<pre><code>##  [1] 0.197 0.013 0.023 0.068 0.111 0.045 0.281 0.048 0.183 0.004 0.002 0.052
## [13] 0.106 0.002 0.266 0.267 0.017 0.401 0.091 0.123 0.219 0.281 0.206 0.035
## [25] 0.371 0.301 0.119 0.001 0.011 0.189 0.463 0.024 0.014 0.272 0.021 0.423
## [37] 0.067 0.426 0.061 0.458 0.125 0.145 0.433 0.145 0.197 0.011 0.187 0.130
## [49] 0.017 0.197 0.002 0.210 0.092 0.080 0.471 0.077 0.032 0.331 0.061 0.037
## [61] 0.154 0.170 0.309 0.036 0.158 0.205 0.059 0.183 0.003 0.048 0.342 0.100
## [73] 0.358 0.443 0.290 0.075 0.034 0.026 0.060 0.005 0.310 0.122 0.064 0.494
## [85] 0.126</code></pre>
<p>We can use <code><a href="../reference/lisa_clusters.html">lisa_clusters()</a></code> to get the cluster indicators of local Moran computation. The p-value threshold can be specified via the argument <code>cutoff</code>.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">lisa</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="va">cats</span></code></pre></div>
<pre><code>##  [1] 0 1 1 0 0 2 0 2 0 2 2 0 0 2 0 0 1 0 0 0 0 0 0 2 0 0 0 2 2 0 0 2 1 0 3 0 0 0
## [39] 0 0 0 0 0 0 0 2 0 0 3 0 1 0 0 0 0 0 1 0 0 1 0 0 0 2 0 0 0 0 1 1 0 0 0 0 0 0
## [77] 2 2 0 2 0 0 0 0 0</code></pre>
<p>The predefined values of the indicators of LISA cluster are:</p>
<pre><code>0 Not significant
1 High-High
2 Low-Low
3 High-Low
4 Low-High
5 Undefined
6 Isolated</code></pre>
<p>which can be accessed via the function <code><a href="../reference/lisa_labels.html">lisa_labels()</a></code>:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lbls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisa_labels.html">lisa_labels</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span>
<span class="va">lbls</span></code></pre></div>
<pre><code>## [1] "Not significant" "High-High"       "Low-Low"         "High-Low"       
## [5] "Low-High"        "Undefined"       "Isolated"</code></pre>
<p>By default, the <code><a href="../reference/local_moran.html">local_moran()</a></code> function will run with some default parameters, e.g.:</p>
<pre><code>permutation number: 999
seed for random number generator: 123456789</code></pre>
<p>These default parameters are identical to the GeoDa desktop software so that we can replicate the results as using the GeoDa software. It is also easy to change these paremters by specifying particular arguments and re-run the LISA computation.</p>
<p>For example, re-run the above local Moran example using 9999 permutations.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lisa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_moran.html">local_moran</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">crm_prs</span>, perm <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span></code></pre></div>
<p>Then, we can use the same <code>lisa</code> object to get the new results after 9999 permutations:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span>
<span class="va">pvals</span></code></pre></div>
<pre><code>##  [1] 0.1942 0.0060 0.0110 0.0588 0.1209 0.0474 0.2793 0.0575 0.1797 0.0019
## [11] 0.0010 0.0493 0.1247 0.0019 0.2850 0.2651 0.0062 0.4180 0.0619 0.1090
## [21] 0.2480 0.2766 0.2013 0.0377 0.3610 0.2982 0.1253 0.0003 0.0094 0.1739
## [31] 0.4537 0.0131 0.0091 0.2390 0.0182 0.4075 0.0675 0.4231 0.0613 0.4416
## [41] 0.1083 0.1334 0.4467 0.1295 0.1672 0.0082 0.1657 0.1143 0.0230 0.2097
## [51] 0.0013 0.2167 0.0750 0.0785 0.4691 0.0699 0.0276 0.3119 0.0545 0.0259
## [61] 0.1175 0.1893 0.3255 0.0286 0.1476 0.1949 0.0498 0.1660 0.0050 0.0402
## [71] 0.3262 0.1026 0.3571 0.4595 0.2792 0.0637 0.0264 0.0302 0.0507 0.0033
## [81] 0.3292 0.1137 0.0635 0.4967 0.1410</code></pre>
<p><code>rgeoda</code> uses <code>GeoDa</code> C++ code, in which multi-threading is used to accelerate the computation of LISA. We can use the argument <code>ncpu</code> to specify how many threads to run the computation:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lisa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_moran.html">local_moran</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">crm_prs</span>, cpu_threads <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>Get the False Discovery Rate value based on current pseudo-p values:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisa_fdr.html">lisa_fdr</a></span><span class="op">(</span><span class="va">lisa</span>, <span class="fl">0.05</span><span class="op">)</span>
<span class="va">fdr</span></code></pre></div>
<pre><code>## [1] 0.0005882353</code></pre>
<p>Then, one can set the FDR value as the cutoff p-value to filter the cluster results:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cat_fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">lisa</span>, cutoff <span class="op">=</span> <span class="va">fdr</span><span class="op">)</span>
<span class="va">cat_fdr</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [39] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [77] 0 0 0 0 0 0 0 0 0</code></pre>
</div>
<div id="use-local_geary-for-local-geary" class="section level4">
<h4 class="hasAnchor">
<a href="#use-local_geary-for-local-geary" class="anchor"></a>4.1.2 Use <code>local_geary</code> for Local Geary</h4>
<p>Local Geary is a type of LISA that focuses on squared differences/dissimilarity. A small value of the local geary statistics suggests positive spatial autocorrelation, whereas large values suggest negative spatial autocorrelation.</p>
<p>For example, we can call the function <code><a href="../reference/local_geary.html">local_geary()</a></code> with the created Queen weights and apply the Local Gary to analyze the spatial patterns of the variable “crm_prp”:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geary_crmprs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_geary.html">local_geary</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">crm_prs</span><span class="op">)</span></code></pre></div>
<p>To get the cluster indicators of the local Geary computation:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">geary_crmprs</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 0 1 2 0 0 0 0 0 0 2 2 0 0 0 0 0 0 1 0 0 0 0 2 0 0 0 2 0 2 0 2 0 0 0 0 0 0
## [39] 0 0 0 0 0 0 0 2 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 1
## [77] 2 0 2 2 0 0 0 0 0</code></pre>
<p>To get the pseudo-p values of the local Geary computation:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">geary_crmprs</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0.103 0.094 0.047 0.003 0.114 0.058 0.244 0.069 0.415 0.240 0.001 0.001
## [13] 0.144 0.391 0.300 0.058 0.375 0.251 0.028 0.056 0.212 0.394 0.281 0.015
## [25] 0.477 0.459 0.081 0.007 0.372 0.031 0.059 0.003 0.258 0.294 0.057 0.458
## [37] 0.192 0.109 0.452 0.425 0.407 0.305 0.061 0.116 0.397 0.006 0.122 0.081
## [49] 0.090 0.084 0.003 0.312 0.238 0.078 0.546 0.042 0.059 0.357 0.114 0.573
## [61] 0.150 0.067 0.177 0.062 0.302 0.197 0.322 0.462 0.002 0.015 0.359 0.095
## [73] 0.175 0.298 0.307 0.040 0.016 0.158 0.001 0.001 0.133 0.233 0.051 0.425
## [85] 0.551</code></pre>
</div>
<div id="use-local_multigeary-for-multivariate-local-geary" class="section level4">
<h4 class="hasAnchor">
<a href="#use-local_multigeary-for-multivariate-local-geary" class="anchor"></a>4.1.3 Use <code>local_multigeary</code> for Multivariate Local Geary:</h4>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span><span class="va">guerry_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Crm_prs'</span>,<span class="st">'Crm_prp'</span>,<span class="st">'Litercy'</span>,<span class="st">'Donatns'</span>,<span class="st">'Infants'</span>,<span class="st">'Suicids'</span><span class="op">)</span><span class="op">]</span>
<span class="va">multigeary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_multigeary.html">local_multigeary</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">data</span><span class="op">)</span></code></pre></div>
<p>To get the cluster indicators of the local Geary computation:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">multigeary</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 1 1 1 1 1 0 0 1 1 1 1 0 1 0 0 1 0 0 0 0 0
## [39] 1 0 1 2 1 1 1 0 0 0 1 1 1 0 1 1 0 0 1 1 0 1 1 0 1 0 1 1 0 1 0 1 1 0 1 1 0 1
## [77] 1 1 1 1 0 1 0 1 1</code></pre>
</div>
<div id="local-getis-ord-statistics" class="section level4">
<h4 class="hasAnchor">
<a href="#local-getis-ord-statistics" class="anchor"></a>4.1.4 Local Getis-Ord Statistics</h4>
<p>There are two types of local Getis-Ord statistics: one is computing a ratio of the weighted average of the values in the neighboring locations, not including the value at the location; while another type of statistic includes the value at the location in both numerator and denominator.</p>
<p>A value larger than the mean suggests a high-high cluster or hot spot, a value smaller than the mean indicates a low-low cluster or cold spot.</p>
<p>For example, we can call the function <code><a href="../reference/local_g.html">local_g()</a></code> with the created Queen weights and the data “crm_prp” as input parameters:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">localg_crmprs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_g.html">local_g</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">crm_prs</span><span class="op">)</span></code></pre></div>
<p>To get the cluster indicators of the local G computation:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">localg_crmprs</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 1 1 0 0 2 0 2 0 2 2 0 0 2 0 0 1 0 0 0 0 0 0 2 0 0 0 2 2 0 0 2 1 0 1 0 0 0
## [39] 0 0 0 0 0 0 0 2 0 0 1 0 1 0 0 0 0 0 1 0 0 1 0 0 0 2 0 0 0 0 1 1 0 0 0 0 0 0
## [77] 2 2 0 2 0 0 0 0 0</code></pre>
<p>To get the pseudo-p values of the local G computation:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">localg_crmprs</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0.197 0.013 0.023 0.068 0.111 0.045 0.281 0.048 0.183 0.004 0.002 0.052
## [13] 0.106 0.002 0.266 0.267 0.017 0.401 0.091 0.123 0.219 0.281 0.207 0.035
## [25] 0.371 0.301 0.119 0.001 0.011 0.189 0.463 0.024 0.014 0.272 0.021 0.423
## [37] 0.067 0.426 0.061 0.458 0.125 0.145 0.433 0.145 0.197 0.011 0.187 0.130
## [49] 0.017 0.197 0.002 0.210 0.092 0.080 0.471 0.077 0.032 0.331 0.061 0.037
## [61] 0.154 0.170 0.309 0.035 0.158 0.205 0.059 0.183 0.003 0.048 0.342 0.100
## [73] 0.358 0.443 0.290 0.075 0.034 0.026 0.060 0.005 0.310 0.122 0.064 0.494
## [85] 0.126</code></pre>
<p>For the second type of local Getis-Ord statistics, we can call the function <code><a href="../reference/local_gstar.html">local_gstar()</a></code> with the created Queen weights and the data “crm_prp” as input parameters:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">localgstar_crmprs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_gstar.html">local_gstar</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">crm_prs</span><span class="op">)</span>
<span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">localgstar_crmprs</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0.197 0.013 0.023 0.068 0.111 0.045 0.281 0.048 0.183 0.004 0.002 0.052
## [13] 0.106 0.002 0.266 0.267 0.017 0.401 0.091 0.123 0.219 0.281 0.207 0.035
## [25] 0.371 0.301 0.119 0.001 0.011 0.189 0.463 0.024 0.014 0.272 0.021 0.423
## [37] 0.067 0.426 0.061 0.458 0.125 0.145 0.433 0.145 0.197 0.011 0.187 0.130
## [49] 0.017 0.197 0.002 0.210 0.092 0.080 0.471 0.077 0.032 0.331 0.061 0.037
## [61] 0.154 0.170 0.309 0.035 0.158 0.205 0.059 0.183 0.003 0.048 0.342 0.100
## [73] 0.358 0.443 0.290 0.075 0.034 0.026 0.060 0.005 0.310 0.122 0.064 0.494
## [85] 0.126</code></pre>
</div>
<div id="local-join-count" class="section level4">
<h4 class="hasAnchor">
<a href="#local-join-count" class="anchor"></a>4.1.5 Local Join Count</h4>
<p>Local Join Count is a method to identify local clusters for binary data by using a local version of the so-called BB join count statistic. The statistic is only meaningful for those observations with value 1.</p>
<p>For example, we can call the function <code><a href="../reference/local_joincount.html">local_joincount()</a></code> with a Queen weights and the data “TopCrm”, which is a set of binary (0,1) values, as input parameters:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top_crm</span> <span class="op">&lt;-</span> <span class="va">guerry_df</span><span class="op">[</span><span class="st">'TopCrm'</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">localjc_crm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_joincount.html">local_joincount</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">top_crm</span><span class="op">)</span></code></pre></div>
<p>To get the pseudo-p values of the local Join Count computation:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">localjc_crm</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0.395 0.085 0.094 0.001 0.001 0.001 0.231 0.001 0.001 0.001 0.001 0.001
## [13] 0.001 0.001 0.001 0.001 0.001 0.001 0.181 0.269 0.376 0.001 0.001 0.001
## [25] 0.001 0.001 0.102 0.001 0.001 0.001 0.001 0.001 0.001 0.103 0.001 0.001
## [37] 0.182 0.001 0.001 0.281 0.001 0.001 0.001 0.001 0.001 0.001 0.222 0.396
## [49] 0.001 0.365 0.041 0.202 0.184 0.369 0.001 0.289 0.029 0.370 0.298 0.106
## [61] 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.003 0.293 0.001 0.001
## [73] 0.001 0.001 0.001 0.058 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.001
## [85] 0.001</code></pre>
<p>To get the cluster indicators of the local Join Count computation:</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">localjc_crm</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [39] 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
## [77] 0 0 0 0 0 0 0 0 0</code></pre>
<p>To get the number of neighbors of the local Join Count computation:</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_num_nbrs.html">lisa_num_nbrs</a></span><span class="op">(</span><span class="va">localjc_crm</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 4 6 6 4 3 7 3 3 5 5 7 3 3 6 5 5 6 6 7 3 6 7 2 5 6 6 2 6 6 6 4 4 6 6 5 6 5 4
## [39] 6 7 5 4 7 6 6 5 8 4 6 6 5 4 5 4 2 6 3 6 6 2 6 3 3 2 4 2 4 5 7 6 2 3 8 6 5 5
## [77] 5 6 3 6 4 6 6 6 5</code></pre>
</div>
<div id="multivariate-local-join-count" class="section level4">
<h4 class="hasAnchor">
<a href="#multivariate-local-join-count" class="anchor"></a>4.1.6 Multivariate Local Join Count:</h4>
<p>Bivariate Local Join Count: in a bivariate local join count, the two events cannot happen in the same location, which is also called “no-colocation” in this tutorial. To demonstrate this function, we just manually create a new variable from top_crm:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top_crm</span> <span class="op">&lt;-</span> <span class="va">guerry_df</span><span class="op">[</span><span class="st">'TopCrm'</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># get 0/1 values </span>
<span class="va">inv_crm</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">top_crm</span> <span class="co"># create no-location case</span></code></pre></div>
<p>Now, top_crm and inv_crm are no-colocation bivariate cases. Then, we apply the local_bijoicount():</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">jc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_bijoincount.html">local_bijoincount</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">top_crm</span>, <span class="va">inv_crm</span><span class="op">)</span></code></pre></div>
<p>To get the cluster indicators of the multivariate local join count computation:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">jc</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0.106 0.013 0.017 0.000 0.000 0.000 0.035 0.000 0.000 0.000 0.000 0.000
## [13] 0.000 0.000 0.135 0.000 0.000 0.000 0.040 0.024 0.296 0.000 0.000 0.000
## [25] 0.000 0.000 0.000 0.000 0.000 0.000 0.208 0.000 0.000 0.398 0.000 0.000
## [37] 0.047 0.000 0.000 0.407 0.000 0.000 0.000 0.000 0.000 0.000 0.487 0.098
## [49] 0.000 0.292 0.007 0.416 0.035 0.101 0.000 0.076 0.000 0.305 0.086 0.000
## [61] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.001 0.100 0.000 0.000
## [73] 0.000 0.000 0.000 0.005 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [85] 0.000</code></pre>
<p>To get the cluster indicators of the local Join Count computation:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">jc</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 1 1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0
## [39] 0 0 0 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 1
## [77] 0 0 0 0 0 0 0 0 0</code></pre>
<p>Co-location Local Join Count: where two or more events happen in the same location. Therefore, the function local_multijoincount takes a list of variables with 0/1 values as the input parameter:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bin_data</span> <span class="op">&lt;-</span> <span class="va">guerry_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'TopWealth'</span>,<span class="st">'TopWealth'</span>, <span class="st">'TopLit'</span><span class="op">)</span><span class="op">]</span> 
<span class="va">jc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_multijoincount.html">local_multijoincount</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">bin_data</span><span class="op">)</span></code></pre></div>
<p>To get the cluster indicators of the multivariate local join count computation:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">jc</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0.000 0.000 0.000 0.256 0.205 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [13] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [25] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [37] 0.319 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [49] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [61] 0.000 0.175 0.192 0.000 0.000 0.000 0.000 0.051 0.000 0.000 0.000 0.000
## [73] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.348
## [85] 0.000</code></pre>
</div>
<div id="quantile-lisa" class="section level4">
<h4 class="hasAnchor">
<a href="#quantile-lisa" class="anchor"></a>4.1.7 Quantile LISA</h4>
<p>The quantile LISA converts the continuous variable to a binary variable that takes the value of 1 for a specific quantile, and then apply local join count statistics on the binary data. For example, we take the first from the 4 quantiles of variable “crm_prs” and apply local_quantilelisa()</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_quantilelisa.html">local_quantilelisa</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="va">crm_prs</span><span class="op">)</span></code></pre></div>
<p>To get the p-values and cluster indicators of the quantile LISA computation:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">qsa</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0.001 0.001 0.001 0.044 0.001 0.050 0.001 0.422 0.001 0.001 0.010 0.013
## [13] 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.095
## [25] 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.045 0.001 0.001 0.001 0.001
## [37] 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.173 0.001 0.083 0.001 0.001
## [49] 0.001 0.001 0.001 0.001 0.001 0.001 0.426 0.001 0.001 0.001 0.001 0.001
## [61] 0.001 0.001 0.001 0.433 0.249 0.428 0.001 0.001 0.001 0.001 0.458 0.001
## [73] 0.001 0.181 0.001 0.001 0.352 0.001 0.010 0.001 0.001 0.001 0.001 0.001
## [85] 0.001</code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">qsa</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 0 0 1 0 1 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 1 0 0 0 0 0 0
## [39] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [77] 0 0 1 1 0 0 0 0 0</code></pre>
<p>Multivariate Quantile LISA</p>
<p>One can construct binary data from different variables with different configurations of number of quantiles and which quantile to use (set value to 1), and check the local spatial autocorrelation:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crm_prp</span> <span class="op">&lt;-</span> <span class="va">guerry_df</span><span class="op">[</span><span class="st">'Crm_prp'</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">quantiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="va">crm_prs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span>, <span class="va">crm_prp</span><span class="op">)</span><span class="op">)</span>
<span class="va">qsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_multiquantilelisa.html">local_multiquantilelisa</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">quantiles</span><span class="op">)</span></code></pre></div>
<p>To get the p-values and cluster indicators of the quantile LISA computation:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_pvalues.html">lisa_pvalues</a></span><span class="op">(</span><span class="va">qsa</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.244
## [13] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [25] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [37] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
## [49] 0.000 0.000 0.000 0.000 0.000 0.000 0.172 0.000 0.000 0.000 0.000 0.000
## [61] 0.000 0.000 0.000 0.000 0.040 0.170 0.000 0.000 0.000 0.000 0.158 0.000
## [73] 0.000 0.441 0.000 0.000 0.000 0.000 0.000 0.421 0.000 0.000 0.000 0.000
## [85] 0.000</code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/lisa_clusters.html">lisa_clusters</a></span><span class="op">(</span><span class="va">qsa</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [39] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0
## [77] 0 0 0 0 0 0 0 0 0</code></pre>
</div>
</div>
</div>
<div id="spatial-clustering" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-clustering" class="anchor"></a>5 Spatial Clustering</h2>
<p>Spatial clustering aims to group a large number of geographic areas or points into a smaller number of regions based on similarities in one or more variables. Spatially constrained clustering is needed when clusters are required to be spatially contiguous.</p>
<p>In <code>GeoDa</code>, there are three different methods explicitly incorporate the contiguity constraint in the optimization process: SKATER, Redcap and Max-p. More details, please check: <a href="http://geodacenter.github.io/workbook/8_spatial_clusters/lab8.html" class="uri">http://geodacenter.github.io/workbook/8_spatial_clusters/lab8.html</a> All of these methods are included in rgeoda 0.0.6.</p>
<p>For example, to apply spatial clustering on the Guerry dataset, we use the queen weights to define the spatial contiguity and select 6 variables for similarity measure: “Crm_prs”, “Crm_prp”, “Litercy”, “Donatns”, “Infants”, “Suicids”.</p>
<p>The following code is used to get a 2D data vector for the selected variables:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">guerry_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Crm_prs'</span>,<span class="st">'Crm_prp'</span>,<span class="st">'Litercy'</span>,<span class="st">'Donatns'</span>,<span class="st">'Infants'</span>,<span class="st">'Suicids'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div id="skater" class="section level3">
<h3 class="hasAnchor">
<a href="#skater" class="anchor"></a>5.1 SKATER</h3>
<p>The Spatial C(K)luster Analysis by Tree Edge Removal(SKATER) algorithm introduced by Assuncao et al. (2006) is based on the optimal pruning of a minimum spanning tree that reflects the contiguity structure among the observations. It provides an optimized algorithm to prune to tree into several clusters that their values of selected variables are as similar as possible.</p>
<p>The <code>rgeoda</code>’s SKATER function is:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="kw">skater</span>(k, w, data, <span class="dt">distance_method=</span><span class="st">'euclidean'</span>, <span class="dt">bound_vals =</span> [],  <span class="dt">min_bound =</span> <span class="dv">0</span>, <span class="dt">random_seed=</span><span class="dv">123456789</span>)</span></code></pre></div>
<p>For example, to create 4 spatially contiguous clusters using Guerry dataset, the queen weights and the values of the 6 selected variables:</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">guerry_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/skater.html">skater</a></span><span class="op">(</span><span class="fl">4</span>, <span class="va">queen_w</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">guerry_clusters</span></code></pre></div>
<pre><code>## [[1]]
##  [1] 15 74 16 55 60 39 68 33 17 82 81  0  2 40 20 80
## 
## [[2]]
##  [1] 46 50 34 38 69 47 58 19 32 41 53 26
## 
## [[3]]
##  [1] 23 79  3 29 61 21 44 11 28 13 30 35 76 77 43  9 27 45 31 78  4 10 66 37  5
## [26] 14  7 63 62
## 
## [[4]]
##  [1] 49 52 72 84  8 57 56 59 42  1 25 51 48 54 64 75 18 83 73 36 24 71  6 67 65
## [26] 70 22 12</code></pre>
<p>This <code><a href="../reference/skater.html">skater()</a></code> function returns a 2D list, which represents 4 clusters. Each cluster is composed by several contiguity areas, e.g. 15, 74, 16, 55, 60, 39, 68, 33, 17, 82, 81, 0, 2, 40, 20, 80</p>
<p><code>rgeoda</code> also provides utility functions to compute some descriptive statistics of the clustering results, e.g. to compute the ratio of between to total sum of squares:</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">guerry_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">totalss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/total_sumofsquare.html">total_sumofsquare</a></span><span class="op">(</span> <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span>  <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.3156447</code></pre>
</div>
<div id="redcap" class="section level3">
<h3 class="hasAnchor">
<a href="#redcap" class="anchor"></a>5.2 REDCAP</h3>
<p>REDCAP (Regionalization with dynamically constrained agglomerative clustering and partitioning) is developed by D. Guo (2008). Like SKATER, REDCAP starts from building a spanning tree in 3 different ways (single-linkage, average-linkage, and the complete-linkage). The single-linkage way leads to build a minimum spanning tree. Then, REDCAP provides 2 different ways (first-order and full-order constraining) to prune the tree to find clusters. The first-order approach with a minimum spanning tree is the same as SKATER. In <code>GeoDa</code> and <code>rgeoda</code>, the following methods are provided:</p>
<ul>
<li>First-order and Single-linkage</li>
<li>Full-order and Complete-linkage</li>
<li>Full-order and Average-linkage</li>
<li>Full-order and Single-linkage</li>
<li>Full-order and Wards-linkage</li>
</ul>
<p>For example, to find 4 clusters using the same dataset and weights as above using REDCAP with Full-order and Complete-linkage method:</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">redcap_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redcap.html">redcap</a></span><span class="op">(</span><span class="fl">4</span>, <span class="va">queen_w</span>, <span class="va">data</span>, <span class="st">"fullorder-completelinkage"</span><span class="op">)</span>
<span class="va">redcap_clusters</span></code></pre></div>
<pre><code>## [[1]]
##  [1] 46 50 34 38 15 74 21 16 55 13 60 69 47 58 19 32 33 53 39 68 17 82  0 41 81
## [26]  2 14  5 26 80 20
## 
## [[2]]
##  [1] 49 52 72 84 56 59  1 57 25 42  8 48 54 64 51 18 36 73 24 71  6 67 83 75 65
## [26] 22 70 12
## 
## [[3]]
## [1] 40
## 
## [[4]]
##  [1] 23 79 29 61 44  3 28 76 77  9 27 45 11 78 43 35 66 31 30 37 10 63  4  7 62</code></pre>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">redcap_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">totalss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/total_sumofsquare.html">total_sumofsquare</a></span><span class="op">(</span> <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.351099</code></pre>
</div>
<div id="azp" class="section level3">
<h3 class="hasAnchor">
<a href="#azp" class="anchor"></a>5.3 AZP</h3>
<p>The automatic zoning procedure (AZP) was initially outlined in Openshaw (1977) as a way to address some of the consequences of the modifiable areal unit problem (MAUP). In essence, it consists of a heuristic to find the best set of combinations of contiguous spatial units into p regions, minimizing the within-sum of squares as a criterion of homogeneity. The number of regions needs to be specified beforehand, as in most other clustering methods considered so far.</p>
<p><code>rgeoda</code> provides three different heuristic algorithms to find an optimal solution for AZP:</p>
<ul>
<li>greedy</li>
<li>Tabu Search</li>
<li>Simulated Annealing</li>
</ul>
<p>The original AZP heuristic is a local optimization procedure that cycles through a series of possible swaps between spatial units at the boundary of a set of regions. The process starts with an initial feasible solution, i.e., a grouping of n spatial units into p contiguous regions. This initial solution can be constructed in several different ways. The initial solution must satisfy the contiguity constraints. For example, this can be accomplished by growing a set of contiguous regions from p randomly selected seed units by adding neighboring locations until the contiguity constraint can no longer be met.</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">azp_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/azp_greedy.html">azp_greedy</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">queen_w</span>, <span class="va">data</span><span class="op">)</span>

<span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">azp_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.3598541</code></pre>
<p>To call AZP simulate annealing algorithm, one needs to specify <code>cooling_rate</code> (default: 0.85):</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">azp_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/azp_sa.html">azp_sa</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">queen_w</span>, <span class="va">data</span>, cooling_rate <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span>

<span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">azp_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.4211363</code></pre>
<p>To call AZP Tabu search algorithm, one needs to specify <code>tabu_length</code> (deafult: 10) , or <code>conv_tabu</code> (default: 10):</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">azp_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/azp_tabu.html">azp_tabu</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">queen_w</span>, <span class="va">data</span>, tabu_length <span class="op">=</span> <span class="fl">10</span>, conv_tabu <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">azp_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.4222174</code></pre>
</div>
<div id="max-p" class="section level3">
<h3 class="hasAnchor">
<a href="#max-p" class="anchor"></a>5.4 Max-p</h3>
<p>The so-called max-p regions model (outlined in Duque, Anselin, and Rey 2012) uses a different approach and considers the regionalization problem as an application of integer programming. Besides, the number of regions is determined endogenously.</p>
<p>The algorithm itself consists of a search process that starts with an initial feasible solution and iteratively improves upon it while maintaining contiguity among the elements of each cluster. <code>rgeoda</code> provides three different heuristic algorithms to find an optimal solution for max-p:</p>
<ul>
<li>greedy</li>
<li>Tabu Search</li>
<li>Simulated Annealing</li>
</ul>
<p>Unlike SKATER and REDCAP that one can specify the number of clusters as an input parameter, max-p doesn’t allow to specify the number of clusters explicitly, but a constrained variable and the minimum bounding value that each cluster should reach that are used to find an optimized number of clusters.</p>
<p>For example, to use the <code>greedy</code> algorithm in maxp function with the same dataset and weights as above to find optimal clusters using max-p:</p>
<p>First, we need to specify, for example, every cluster must have population &gt;= 3236.67 thousand people:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bound_vals</span> <span class="op">&lt;-</span> <span class="va">guerry_df</span><span class="op">[</span><span class="st">'Pop1831'</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">min_bound</span> <span class="op">&lt;-</span> <span class="fl">3236.67</span> <span class="co"># 10% of Pop1831</span></code></pre></div>
<p>Then, we can call the max-p function with the “greedy” algorithm, the bound values, and minimum bound value:</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maxp_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxp_greedy.html">maxp_greedy</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">data</span>, <span class="va">bound_vals</span>, <span class="va">min_bound</span>, iterations<span class="op">=</span><span class="fl">99</span><span class="op">)</span>

<span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">maxp_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.4499671</code></pre>
<pre><code>Note: the results of max-p may be different with GeoDa desktop software, it is caused by the different implementation of boost::unordered_map in version 1.58 (used in GeoDa) and version 1.75 (used in rgeoda via BH package). The keys in boost::unordered_map are not ordered and have different orders in the two Boost versions we used. This involves a different mechanism of randomness in max-p algorithm when picking which area or region to process. Therefore, the results might be slightly different. This is normal and shows the sensitiveness of the max-p algorithm: see https://geodacenter.github.io/workbook/9d_spatial4/lab9d.html#max-p-region-problem for more about sensitivy study of max-p algorithm.

If you want to replicate the identical results as in GeoDa software, please install BH == 1.58.0-1 and build/install rgeoda from source using: devtools::install_github("lixun910/rgeoda")</code></pre>
<p>We can also specify using <code>tabu search</code> algorithm in maxp function with the parameter of tabu length:</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maxp_tabu_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxp_tabu.html">maxp_tabu</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">data</span>, <span class="va">bound_vals</span>, <span class="va">min_bound</span>, tabu_length<span class="op">=</span><span class="fl">10</span>, conv_tabu<span class="op">=</span><span class="fl">10</span><span class="op">)</span>

<span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">maxp_tabu_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.4893668</code></pre>
<p>To apply <code>simulated annealing</code> algorithm in maxp function with the parameter of cooling rate:</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maxp_sa_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxp_sa.html">maxp_sa</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">data</span>, <span class="va">bound_vals</span>, <span class="va">min_bound</span>, cooling_rate<span class="op">=</span><span class="fl">0.85</span>, sa_maxit<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">maxp_sa_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.4585352</code></pre>
<p>We can also increase the number of iterations for local search process by specifying the parameter <code>iterations</code> (default value is 99):</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maxp_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxp_greedy.html">maxp_greedy</a></span><span class="op">(</span><span class="va">queen_w</span>, <span class="va">data</span>, <span class="va">bound_vals</span>, <span class="va">min_bound</span>, iterations<span class="op">=</span><span class="fl">199</span><span class="op">)</span>

<span class="va">betweenss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/between_sumofsquare.html">between_sumofsquare</a></span><span class="op">(</span><span class="va">maxp_clusters</span>, <span class="va">data</span><span class="op">)</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">betweenss</span> <span class="op">/</span> <span class="va">totalss</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"The ratio of between to total sum of square:"</span>, <span class="va">ratio</span><span class="op">)</span></code></pre></div>
<pre><code>## The ratio of between to total sum of square: 0.4774111</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Xun Li, Luc Anselin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
